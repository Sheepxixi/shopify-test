{% layout none %}
<div style="max-width:720px;margin:40px auto;padding:24px;border:1px solid #eee;border-radius:12px;font-family:system-ui,-apple-system,Segoe UI,Roboto">
  <h1 style="margin:0 0 12px 0;font-size:22px">Updating quote statusâ€¦</h1>
  <p style="color:#666">Please wait while we sync your quote.</p>
</div>

<script>
(function(){
  const params = new URLSearchParams(window.location.search);
  const uuid = params.get('uuid');
  const price = params.get('price');
  const invoice = params.get('invoice');
  if (!uuid) {
    window.location.replace('/cart?view=quote');
    return;
  }

  fetch('/cart.js')
    .then(r => r.json())
    .then(cart => {
      const idx = cart.items.findIndex(it => it.properties && (it.properties._uuid === uuid));
      if (idx === -1) throw new Error('Quote line item not found');
      const item = cart.items[idx];

      const newProps = Object.assign({}, item.properties || {});
      newProps['Quote Status'] = 'Quoted';
      if (price) newProps['Quoted Price'] = price;
      if (invoice) newProps['Invoice URL'] = invoice;

      return fetch('/cart/change.js', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
        body: JSON.stringify({ id: item.key, properties: newProps })
      });
    })
    .then(() => {
      window.location.replace('/cart?view=quote');
    })
    .catch(() => {
      window.location.replace('/cart?view=quote');
    });
})();
</script>


